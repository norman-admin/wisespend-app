<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gastos Familiares</title>

    <!-- CSS en orden optimizado para arquitectura modular -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="header-redesigned/css/new-header.css">
    <link rel="stylesheet" href="header-redesigned/css/period-selector.css">
    <link rel="stylesheet" href="css/income-table-enhanced.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="mobile/css/mobile-main.css" media="(max-width: 768px)">
    <link rel="stylesheet" href="css/config-sections.css">
    <link rel="stylesheet" href="css/reportes.css">
    <link rel="stylesheet" href="css/table-filter.css">
    <link rel="stylesheet" href="css/gastos-extras-mejorados.css">
    <link rel="stylesheet" href="varios/css/espacio-personal.css">


    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Meta tags -->
    <meta name="description" content="Dashboard de control de gastos familiares">
    <meta name="theme-color" content="#3b82f6">
</head>

<body class="dashboard-body">
    <!-- Header Principal - Cargado din√°micamente -->
    <div id="header-container"></div>

    <!-- Tarjetas de Resumen - Cargadas din√°micamente -->
    <div id="stats-container"></div>

    <!-- Contenido Principal - LAYOUT 3 COLUMNAS -->
    <main class="main-content">
        <!-- Men√∫ Lateral - Cargado din√°micamente -->
        <div id="sidebar-container"></div>

        <!-- √Årea de Contenido Principal -->
        <div class="content-area" id="dynamic-content">
            <!-- El contenido se carga directamente aqu√≠ -->
        </div>
    </main>

    <!-- üî∑ Supabase SDK - Versi√≥n espec√≠fica -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <script>
        console.log('üîç Supabase SDK cargado:', typeof supabase);

        if (typeof supabase !== 'undefined' && supabase.createClient) {
            const SUPABASE_URL = 'https://ikudmgmtrerssffihtgl.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlrdWRtZ210cmVyc3NmZmlodGdsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MDQ5MDMsImV4cCI6MjA3NjE4MDkwM30.2Er8z4TZwtI9yvTqve0P_NHzfcxb_MkWKL6f4DHoe7Y';

            window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            console.log('‚úÖ Supabase inicializado correctamente');
            console.log('üîç Cliente creado:', !!window.supabase);
        } else {
            console.error('‚ùå Supabase SDK no se carg√≥ correctamente');
        }
    </script>

    <!-- üî∑ Supabase Client Manager -->
    <script src="js/supabase-client.js"></script>

    <!-- üî∑ Supabase Ingresos Adapter -->
    <script src="js/supabase-ingresos-adapter.js"></script>

    <!-- üî∑ Supabase Storage Manager -->
    <script src="js/supabase-storage.js"></script>

    <!-- üî∑ Storage original (mantiene compatibilidad) -->
    <script src="js/storage.js"></script>
    <!-- üî∑ Temporal Storage (Gesti√≥n de per√≠odos) -->
    <script src="js/temporal-storage.js?v=1.0.3"></script>
    <!-- üî∑ Hybrid Storage (Adaptador Nube/Local) -->
    <script src="js/hybrid-storage.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/currency.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/modal-system.js"></script>
    <script src="js/contextual-manager.js"></script>
    <script src="js/contextual-menu-actions.js"></script>

    <!-- Scripts de gesti√≥n de gastos -->
    <script src="js/gastos-extras-mejorados.js"></script>
    <script src="js/gastos.js"></script>
    <script src="js/income-table-enhanced.js"></script>
    <script src="js/ingresos.js"></script>

    <!-- Scripts de reportes -->
    <script src="js/reportes/reportes-generator.js"></script>
    <script src="js/reportes/reportes-manager.js"></script>
    <script src="js/reportes/reportes-charts.js"></script>
    <script src="js/reportes/reportes-html.js"></script>
    <script src="js/reportes/reportes-export.js"></script>

    <!-- Scripts de interfaz y componentes -->
    <script src="js/table-filter.js"></script>
    <script src="js/component-loader.js"></script>

    <script src="js/config-manager.js"></script>
    <script src="js/config-ui.js"></script>
    <script src="varios/js/varios-manager.js"></script>
    <script src="varios/js/documentos-upload.js"></script>
    <script src="varios/js/documentos.js"></script>

    <!-- Scripts principales -->
    <script src="varios/js/espacio-personal.js"></script>

    <script src="js/dashboard-main.js"></script>
    <script src="js/auth.js"></script>

    <script src="js/categories-table.js"></script>

    <script>
        /**
         * üöÄ DASHBOARD INICIALIZACI√ìN v2.1 - LIMPIO Y SIN ERRORES
         * Control de Gastos Familiares - Arquitectura Modular Corregida
         * 
         * ‚úÖ MEJORAS v2.1:
         * üßπ Eliminadas referencias obsoletas a themeLoader
         * üîß Sistema de temas simplificado (theme-manager v7.0)
         * üéØ Solo funciones que realmente existen
         * ‚ö° Carga optimizada sin timeouts innecesarios
         * üêõ Sin errores de consola
         */

        document.addEventListener('DOMContentLoaded', function () {
            console.log('üé¨ Dashboard v2.1 - Arquitectura Modular LIMPIA iniciada');

            // ‚úÖ Verificaci√≥n de sistemas disponibles (sin errores)
            setTimeout(() => {
                console.log('üîç Verificando sistemas cargados...');

                // Sistema de configuraci√≥n modular
                if (window.configManager) {
                    console.log('‚öôÔ∏è ConfigManager: ‚úÖ Activo v2.0.0');
                    if (window.configDebug) {
                        console.log('üõ†Ô∏è Debug disponible: window.configDebug.testConfig()');
                    }
                } else {
                    console.log('‚öôÔ∏è ConfigManager: ‚è≥ Cargando...');
                }

                // Sistema de temas simplificado
                if (window.themeManager) {
                    console.log('üåô ThemeManager: ‚úÖ v7.0 Simplificado activo');
                    console.log(`üé® Tema actual: ${window.themeManager.getCurrentTheme()}`);
                } else {
                    console.log('üåô ThemeManager: ‚ö†Ô∏è No disponible');
                }

                // Sistema de almacenamiento
                if (window.storageManager) {
                    console.log('üíæ StorageManager: ‚úÖ Activo');
                } else {
                    console.log('üíæ StorageManager: ‚ö†Ô∏è No disponible');
                }

                // Sistema modal
                if (window.modalSystem) {
                    console.log('ü™ü ModalSystem: ‚úÖ Activo');
                } else {
                    console.log('ü™ü ModalSystem: ‚ö†Ô∏è No disponible');
                }

                // Sistema contextual
                if (window.contextualManager) {
                    console.log('üéØ ContextualManager: ‚úÖ Activo');
                } else {
                    console.log('üéØ ContextualManager: ‚ö†Ô∏è No disponible');
                }

                console.log('‚úÖ Verificaci√≥n de sistemas completada');
            }, 1000);

            // üîß Herramientas de debug solo en desarrollo
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                // Solo funciones que realmente existen
                window.debugDashboard = {
                    // Temas (sistema simplificado v7.0)
                    getCurrentTheme: () => window.themeManager?.getCurrentTheme() || 'No disponible',
                    switchTheme: (theme) => {
                        if (window.themeManager?.setTheme) {
                            window.themeManager.setTheme(theme);
                            return `‚úÖ Tema cambiado a: ${theme}`;
                        }
                        return '‚ùå ThemeManager no disponible';
                    },
                    getAvailableThemes: () => window.themeManager?.themes || 'No disponible',

                    // Sistema general
                    getSystemStatus: () => {
                        return {
                            themeManager: !!window.themeManager,
                            storageManager: !!window.storageManager,
                            modalSystem: !!window.modalSystem,
                            contextualManager: !!window.contextualManager,
                            configManager: !!window.configManager,
                            gastosManager: !!window.gastosManager,
                            ingresosManager: !!window.ingresosManager
                        };
                    },

                    // Utilidades
                    forceReload: () => location.reload(),
                    clearStorage: () => {
                        if (confirm('¬øEst√°s seguro de limpiar el localStorage?')) {
                            localStorage.clear();
                            console.log('üßπ localStorage limpio');
                            location.reload();
                        }
                    }
                };

                console.log('üß™ Modo desarrollo activo');
                console.log('üîß Herramientas disponibles en: window.debugDashboard');
                console.log('üìã Comandos:');
                console.log('  ‚Ä¢ getCurrentTheme()');
                console.log('  ‚Ä¢ switchTheme("dark"|"light"|"pastel"|"auto")');
                console.log('  ‚Ä¢ getSystemStatus()');
                console.log('  ‚Ä¢ forceReload()');
                console.log('  ‚Ä¢ clearStorage()');
            }
        });

        // üö® Error handler global para capturar errores no manejados
        window.addEventListener('error', function (e) {
            console.error('üö® Error global capturado:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno
            });
        });


        if (window.innerWidth <= 768) {
            document.write('<script src="mobile/js/mobile-menu.js"><\/script>');
        }

    </script>
</body>

</html>